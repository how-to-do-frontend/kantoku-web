{% extends 'base.html' %}
{% block title %} {{ user['name'] }}'s profile {% endblock %}
<script src="https://kit.fontawesome.com/550094edeb.js" crossorigin="anonymous"></script>
<meta content=" {{ user['name'] }}'s profile | kantoku" property="og:title">
<meta content="Check out {{ user['name'] }}'s profile and many more on Kantoku!" property="og:description"/>
{% macro userpage(user) %} {% if user['userpage_content'] != None
    and user['userpage_content'] != "" %}
    <div class="log-block">
      <div class="header">
        <div class="title">
          <i class="fas fa-address-book"></i> About Me
        </div>
      </div>
      <div class="stats-block rank-block" style="padding: 12.5px">
        <article class="reset-bulma-style">
          {{ render_markdown(user['userpage_content']) | safe }}
        </article>
      </div>
    </div>
    {% endif %} {% endmacro %}
{% macro pinned_scores() %}
<div class="log-blcok">
    <div class="header">
        <div class="title">
            <i class="fas fa-trophy"></i> Pinned Scores
        </div>
    </div>
    <div class="stats-block rank-block" style="padding: 12.5px">
        <p>COMING SOON</p>
    </div>
</div>
{% endmacro %}
{% macro scores(title, id) %}
<div class="log-block" v-bind:class="{ 'load' : data.scores.{{ id }}.load }">
    <div class="header">
        <div class="title">
            <i class="fas fa-trophy"></i> {{ title }}
        </div>
    </div>
    <div v-if="data.scores.{{ id }}.out.length != 0" class="scores">
        <div v-for="(map, index) in data.scores.{{ id }}.out" class="map-single"
            :style="`background: linear-gradient(hsl(var(--main), 25%, 25%, 90%), hsl(var(--main), 25%, 25%, 90%)), url(https://assets.ppy.sh/beatmaps/${map.beatmap.set_id}/covers/cover.jpg);`">
            <div class="map-data">
                <div class="map-content1">
                    <div class="map-image">
                        <img v-bind:src="'https://assets.ppy.sh/beatmaps/' + map.beatmap.set_id + '/covers/card.jpg'"
                            class="map-image-picture">
                    </div>
                    <div class="map-title-block">
                        <div class="map-title">
                            <a class="beatmap-link" v-bind:href="'https://osu.ppy.sh/b/' + map.beatmap.id">
                                <% map.beatmap.artist %> - <% map.beatmap.title %> [<% map.beatmap.version %>] <!--<span v-if="map.mods != 0">+ <% modsStr(map.mods) %></span>-->
                            </a>
                        </div>
                        <div class="play-stats">
                            <% addCommas(map.score) %> / <% map.max_combo %><b>x</b> +<%map.mods_readable%>
                        </div>
                        <div class="map-date">
                            <time>
                                <% moment(map.play_time + '+00:00').local().fromNow() %>
                            </time>
                        </div>
                    </div>
                </div>
                <div class="map-content2">
                    <div class="score-details d-flex">
                        <div class="score-details_right-block">
                            <div class="score-details_pp-block">
                                <div class="map-pp">
                                    <% addCommas(map.pp.toFixed()) %><span class="map-pp-unit">pp</span>
                                </div>
                                <div class="map-acc">accuracy:&nbsp;<b>
                                        <% map.acc.toFixed(2) %>%
                                    </b></div>
                            </div>
                            <div class="score-details_grade-block">
                                <div class="rank-single">
                                    <div v-bind:class="'map-rank rank-'+map.grade">
                                        <% map.grade.replace("X", "SS" ).replace("H", "" ) %>
                                    </div>
                                </div>
                            </div>
                            <div class="score-menu-btn" v-bind:data--score-id="map.id" onclick="scoreMenu(this);">
                                <i class="fa-solid fa-ellipsis-vertical"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div v-else-if="data.scores.{{ id }}.out.length == 0" class="stats-block">
        <div class="columns is-marginless">
            <div class="column is-1">
                <h1 class="title">: (</h1>
            </div>
            <div class="column">
                <h1 class="title is-6">No scores available</h1>
                <p class="subtitle is-7">Try playing something?</p>
            </div>
        </div>
    </div>
    <div v-if="data.scores.{{ id }}.more.full == false" class="extra-block">
        <a class="show-button" @click="AddLimit('{{ id }}score')">Show more</a>
    </div>
</div>
{% endmacro %}

{% macro maps(title, id) %}
<div class="log-block" v-bind:class="{ 'load' : data.maps.{{ id }}.load }">
    <div class="header">
        <div class="title">
            <i class="fas fa-book"></i> Most Played Beatmaps
        </div>
    </div>
    <div v-if="data.maps.{{ id }}.out.length != 0" class="beatmaps">
        <div v-for="(map, index) in data.maps.{{ id }}.out" class="map-single"
            :style="`background: linear-gradient(hsl(var(--main), 0%, 0%, 50%), hsl(var(--main), 25%, 0%, 80%)), url(https://assets.ppy.sh/beatmaps/${map.set_id}/covers/cover.jpg); margin-bottom:0px;`">
            <div class="map-data">
                <div class="map-content1">
                    <div class="map-rank" style="margin-left: 0.2em;margin-right: -0.5em !important;">
                        <i :class="{
                            'fas fa-question': map.status === 0,
                            'fas fa-chevrons-up': map.status === 2,
                            'fas fa-check': map.status === 3,
                            'fas fa-heart': map.status === 5
                          }" 
                          :style="{
                            color: map.status === 0 ? '#ffffff' :
                              map.status === 2 ? '#0080ff' :
                              map.status === 3 ? '#00cc00' :
                              map.status === 5 ? '#ff69b4' :
                              ''
                          }"
                          style="font-size: 1.2em; margin-right: 0.5em;"
                        ></i>
                    </div>
                    <div class="map-title-block">
                      <div class="map-title">
                        <a class="beatmap-link" v-bind:href="'https://{{ domain() }}/b/' + map.id">
                          <% map.artist %> - <% map.title %> 
                          [<% map.version %>]
                        </a>
                        <div class="play-stats">
                          Mapped by <% map.creator %>
                        </div>
                      </div>
                    </div>
                  </div>                  
                <div class="map-content2">
                    <div class="score-details d-flex">
                        <div class="score-details_right-block">
                            <div class="score-details_pp-block">
                                <div class="map-pp">
                                    <% map.plays %></span> 
                                </div>attempts
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div v-else-if="data.maps.{{ id }}.out.length == 0" class="stats-block">
        <div class="columns is-marginless">
            <div class="column is-1">
                <h1 class="title">: (</h1>
            </div>
            <div class="column">
                <h1 class="title is-6">No maps attempted</h1>
                <p class="subtitle is-7">Try playing something?</p>
            </div>
        </div>
    </div>
    <div v-if="data.maps.{{ id }}.more.full == false" class="extra-block">
        <a class="show-button" @click="AddLimit('mostplay')">Show more</a>
    </div>
</div>
{% endmacro %}

{% block header %}
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
<script src="/static/js/asserts/vue.js"></script>
<script src="/static/js/asserts/vue-axios.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.2/timeago.min.js"></script>
<link rel="stylesheet" href="/static/css/pages/profile.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<meta content="{{ user['name'] }}'s profile | Kantoku" property="og:title"/>
<meta property="og:type" content="website" />
<meta property="og:description" content="{{user['name']}} is a Kantoku player from {{ cctoFullName(user['country']|upper)}}." />
<meta property="og:site_name" content="Kantoku" />
<meta property="theme-color" content="#4fb170" />
<meta property="og:image" content="https://a.fysix.xyz/{{ user['id'] }}" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script>
    console.log("{{ user['country']|upper }}")
    var userid = Number("{{ user['id'] }}"); //For text editor doesn't dizzy lmao
    var mode = '{{ mode }}';
    var mods = '{{ mods }}';
    var domain = "{{ domain() }}";
    console.log("{{user}}")
</script>
{% endblock %}

{% block content %}
<div id="app">
    {% if restricted %}
<div class='noti-banner noti-banner-warning'>
    <div class="container">
      <div class="noti-column">
        <div class='noti-col noti-col-icon'></div>
        <div class='noti-col noti-col-label'>
          <div class='noti-bannertype'>
            <div class="noti-bannertext">
                Warning
            </div>
            <div class="noti-banner-text">
                This profile has been placed in restricted mode!
            </div>
          </div>
        </div>
      </div>
    </div>
</div>
{% endif %}
    <div class="main-block">
        <div class="profile-bg">
            <div class="info-block">
                <h1 class="title">
                    <p class="ranks">
                        <span class="bgf"> {{ user['name'] }}</span>
                    </p>
                </h1>
                <transition name="fade">
                    <div class="subtitle" v-if='data.status.online == false'>
                        <div class="what">
                        <img src="/static/images/flags/{{ user['country']|upper }}.png" class="profile-flag">
                        <span class="country">{{ cctoFullName(user['country']|upper)}}</span>
                        </div>  
                        <a class='circle red'>●</a> Last Seen {{ timeago.format((datetime.datetime.fromtimestamp(user["latest_activity"])),
                        (datetime.datetime.now() + datetime.timedelta(seconds = 60 * 3.4))) }}
                    </div>
                    <div class="subtitle" v-else-if='data.status.online == true'>
                        <div class="what">
                            <img src="/static/images/flags/{{ user['country']|upper }}.png" class="profile-flag">
                            <span class="country">{{ cctoFullName(user['country']|upper)}}</span>
                            </div> 
                        <a class='circle green'>●</a> Online
                    </div>
                </transition>
            </div>
            <div class="anime-girl">
                <!-- (if you want to add it)
                    <img src="{your transparent img src}" alt="">
                -->
            </div>
            <transition name="click">
                <div class="online-infomation" v-if='data.status.online == true'
                    :key="actionIntToStr(data.status.status)">
                    <% actionIntToStr(data.status.status) %>
                </div>
            </transition>
        </div>
        <div class="profile-flex">
            <div class="profile-avatar-area">
                <img src="https://a.{{ domain() }}/{{ user['id']}}?{{timestamp()}}" alt="avatar" class="rounded-avatar profile-avatar"
                    onError="this.src='/static/images/avatar_notwork.png';">
            </div>
            {% if badges.length != 0 %}
            <div class="bar-selection badge-selects">
                {% for b in badges %}
                    <div class="badge">
                        <div class="badge-icon" style="margin: 8px 2px 7px {{ b[2] }}px; color: {{ b[3] }};">
                            <i class="fa-solid {{ b[1] }}"></i>
                        </div>
                        <span style=" color: {{ b[3] }};">{{ b[0] }}</span>
                    </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    <div class="second-block">
        <div class="columns is-marginless two-sides">
            <div class="column is-one-third" v-cloak>
                <div class="sidebar-wrapper"  v-if='data.stats.out[modegulag].rank'>
                    <div class="header" v-if='data.stats.out[modegulag].rank != 0'>
                        <div class="title">
                            <i class="fas fa-user-friends"></i> Rank
                        </div>
                    </div>
                    <div class="stats-block rank-block">
                        <table class="is-striped">
                            <tbody>
                                <tr>
                                    <td>Global rank</td>
                                    <td class="right-aligned">
                                        <span id="global-rank">
                                            <% '#' + data.stats.out[modegulag].rank %>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Country rank</td>
                                    <td class="right-aligned">
                                        <span id="country-rank">
                                            <% '#' + data.stats.out[modegulag].country_rank %>
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="header">
                    <div class="title">
                        <i class="fas fa-chart-pie"></i> Statistics
                    </div>
                </div>
                <div class="stats-block">
                    <table class="is-striped">
                        <tbody>
                            <tr>
                                <td><b>PP</b></td>
                                <td class="right-aligned">
                                    <% addCommas(data.stats.out[modegulag].pp) %>
                                </td>
                            </tr>
                            <tr>
                                <td><b>Ranked score</b></td>
                                <td class="right-aligned">
                                    <% addCommas(data.stats.out[modegulag].rscore) %>
                                </td>
                            </tr>
                            <tr>
                                <td><b>Total score</b></td>
                                <td class="right-aligned">
                                    <% addCommas(data.stats.out[modegulag].tscore) %>
                                </td>
                            </tr>
                            <tr>
                                <td><b>Max combo</b></td>
                                <td class="right-aligned">
                                    <% addCommas(data.stats.out[modegulag].max_combo) %>
                                </td>
                            </tr>
                            <tr>
                                <td><b>Playcount</b></td>
                                <td class="right-aligned">
                                    <% addCommas(data.stats.out[modegulag].plays) %>
                                </td>
                            </tr>
                            <tr>
                                <td><b>Playtime</b></td>
                                <td class="right-aligned">
                                    <% secondsToDhm(data.stats.out[modegulag].playtime) %>
                                </td>
                            </tr>
                            <tr>
                                <td><b>Accuracy</b></td>
                                <td class="right-aligned">
                                    <% data.stats.out[modegulag].acc.toFixed(2) %>%
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="grade-block" v-if="data.grades">
                        <article class="media">
                            <div class="media-content">
                                <div class="grade-line">
                                    <div class="rank-single">
                                        <div class="map-rank rank-X">SS</div>
                                        <div class="rank-amount">
                                            <% data.stats.out[modegulag].x_count %>
                                        </div>
                                    </div>
                                    <div class="rank-single">
                                        <div class="map-rank rank-XH">SS</div>
                                        <div class="rank-amount">
                                            <% data.stats.out[modegulag].xh_count %>
                                        </div>
                                    </div>
                                </div>
                                <div class="grade-line">
                                    <div class="rank-single">
                                        <div class="map-rank rank-S">S</div>
                                        <div class="rank-amount">
                                            <% data.stats.out[modegulag].s_count %>
                                        </div>
                                    </div>
                                    <div class="rank-single">
                                        <div class="map-rank rank-SH">S</div>
                                        <div class="rank-amount">
                                            <% data.stats.out[modegulag].sh_count %>
                                        </div>
                                    </div>
                                    <div class="rank-single">
                                        <div class="map-rank rank-A">A</div>
                                        <div class="rank-amount">
                                            <% data.stats.out[modegulag].a_count %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="level-block">
                    <div class="columns is-marginless is-2">
                        <div class="column level-bar is-paddingless">
                            <div class="progress-level"></div>
                        </div>
                        <div class="column level-num is-one-fifth is-textcen">
                            <% data.stats[`level_${modegulag}`] %>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="log-block leaderboard-history-block">
                    <div class="header">
                        <div class="title">
                            <i class="fas fa-chart-line"></i> Leaderboard history
                        </div>
                    </div>

                    <div class="leaderboard-history">
                        <canvas id="leaderboard-history" style="width:100%; height: 120px;"></canvas>
                    </div>
                </div>
                {{ userpage(user) }}
                {{ scores('Pinned Scores', 'pinned') }}
                {{ scores('Best Scores', 'best') }}
                {{ scores('Recent Scores', 'recent') }}
                {{ maps('Most Beatmaps Played', 'most')}}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block bottom %}
<script src="/static/js/pages/profile.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
{% if user['custom_colour'] != 230 %}
<script>
    $('html').css('--main', {{ user['custom_colour']}});
</script>
{% endif %}
{% if user['customisation']['banner'] == True or user['customisation']['background'] == True %}
<style>
    {% if user['customisation']['banner'] == True %}
        .profile-bg {
            min-height: 262px;
            background: linear-gradient(hsl(var(--main), 25%, 25%, 20%), hsl(var(--main), 25%, 25%, 60%)), url("/banners/{{ user['id'] }}");
            background-size: cover;
        }
    {% endif %}
    {% if user['customisation']['background'] == True %}
        body {
            background: linear-gradient(hsl(var(--main), 25%, 25%, 20%), hsl(var(--main), 10%, 10%)), url("/backgrounds/{{ user['id'] }}");
            background-size: cover;
            background-clip: content-box;
        }
    {% endif %}
</style>
{% endif %}
{% endblock bottom %}
